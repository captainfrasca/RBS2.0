<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RBS 2.0 - ROV Training Module Pro</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #0f1419; color: #fff; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
    .header { background: linear-gradient(135deg, #1a1f2e 0%, #2d3748 100%); padding: 8px 20px; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #E30613; box-shadow: 0 2px 10px rgba(0,0,0,.3); }
    .system-title { font-size: 1.2em; font-weight: bold; color: #fff; }
    .header-stats { display: flex; gap: 15px; }
    .stat-badge { display: flex; align-items: center; gap: 5px; padding: 4px 12px; border-radius: 20px; font-weight: bold; font-size: .85em; }
    .stat-badge.critical { background: #e53e3e; }
    .stat-badge.warning { background: #dd6b20; }
    .stat-badge.ok { background: #38a169; }
    .training-indicator { background: #f6ad55; padding: 6px 16px; border-radius: 20px; font-weight: bold; animation: pulseTraining 2s infinite; }
    @keyframes pulseTraining { 0%, 100% { opacity: 1; } 50% { opacity: .6; } }
    .main-container { flex: 1; display: grid; grid-template-columns: 200px 1fr 380px; gap: 8px; padding: 8px; overflow: hidden; }
    .sidebar { background: #1a202c; border-radius: 8px; padding: 10px; overflow-y: auto; }
    .menu-item { padding: 10px 12px; background: rgba(255,255,255,.05); border-radius: 6px; cursor: pointer; transition: .3s; display: flex; align-items: center; gap: 8px; color: #a0aec0; font-size: .85em; margin-bottom: 5px; }
    .menu-item:hover { background: rgba(227,6,19,.2); color: #fff; }
    .menu-item.active { background: #E30613; color: #fff; }
    .center-content { background: #1a202c; border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; }
    .workspace-tabs { display: flex; background: #2d3748; border-bottom: 1px solid rgba(255,255,255,.1); }
    .workspace-tab { padding: 10px 20px; cursor: pointer; transition: .3s; font-size: .9em; border-right: 1px solid rgba(255,255,255,.1); }
    .workspace-tab:hover { background: rgba(227,6,19,.2); }
    .workspace-tab.active { background: #E30613; font-weight: bold; }
    .workspace-content { flex: 1; overflow: auto; position: relative; }
    .right-panel { background: #1a202c; border-radius: 8px; overflow: hidden; display: flex; flex-direction: column; }
    .queue-header { background: #2d3748; padding: 12px 15px; border-bottom: 2px solid #E30613; display: flex; justify-content: space-between; align-items: center; }
    .queue-title { font-weight: bold; font-size: 1em; display: flex; align-items: center; gap: 8px; }
    .queue-count { background: #E30613; padding: 2px 8px; border-radius: 10px; font-size: .85em; }
    .queue-list { flex: 1; overflow-y: auto; padding: 10px; }
    .incident-card { background: rgba(255,255,255,.05); border-left: 4px solid; padding: 12px; margin-bottom: 10px; border-radius: 4px; cursor: pointer; transition: .3s; }
    .incident-card:hover { background: rgba(255,255,255,.08); transform: translateX(3px); }
    .incident-card.priority-1 { border-left-color: #e53e3e; animation: urgentPulse 1.5s infinite; }
    .incident-card.priority-2 { border-left-color: #f6ad55; }
    .incident-card.priority-3 { border-left-color: #3182ce; }
    @keyframes urgentPulse { 0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(229,62,62,0); } 50% { opacity: .8; box-shadow: 0 0 10px 2px rgba(229,62,62,.3); } }
    .incident-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
    .incident-type { background: rgba(227,6,19,.8); padding: 2px 6px; border-radius: 4px; font-size: .75em; font-weight: bold; }
    .incident-time { font-size: .75em; color: #718096; }
    .incident-title { font-weight: bold; margin-bottom: 3px; font-size: .9em; }
    .incident-location { font-size: .8em; color: #a0aec0; }
    .accept-btn { margin-top: 8px; padding: 6px 12px; background: #48bb78; border: none; border-radius: 4px; color: white; font-size: .85em; font-weight: bold; cursor: pointer; width: 100%; transition: .3s; }
    .accept-btn:hover { background: #38a169; }
    .start-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; padding: 40px; }
    .start-title { font-size: 2.5em; font-weight: bold; color: #E30613; margin-bottom: 20px; }
    .start-description { font-size: 1.1em; line-height: 1.8; max-width: 680px; margin-bottom: 30px; color: #a0aec0; }
    .start-btn { padding: 15px 40px; background: #E30613; border: none; border-radius: 8px; color: white; font-size: 1.2em; font-weight: bold; cursor: pointer; transition: .3s; }
    .start-btn:hover { background: #cc0510; transform: scale(1.05); }
    .difficulty-selector { display: flex; gap: 15px; margin: 20px 0; justify-content: center; }
    .difficulty-btn { padding: 15px 30px; background: rgba(255,255,255,.05); border: 2px solid rgba(255,255,255,.2); border-radius: 8px; cursor: pointer; transition: .3s; color: #fff; }
    .difficulty-btn:hover { background: rgba(227,6,19,.2); border-color: #E30613; }
    .difficulty-btn.selected { background: #E30613; border-color: #E30613; }
    .conversation-view { height: 100%; display: flex; flex-direction: column; }
    .conversation-header { background: #2d3748; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
    .caller-info { font-size: 1.1em; font-weight: bold; color: #E30613; }
    .call-timer { font-size: 1.2em; font-weight: bold; color: #48bb78; }
    .conversation-messages { flex: 1; overflow-y: auto; padding: 20px; background: #0f1419; }
    .message { background: rgba(255,255,255,.05); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 3px solid #f6ad55; }
    .message-sender { font-weight: bold; margin-bottom: 5px; font-size: .9em; color: #a0aec0; }
    .response-options { background: #1a202c; padding: 20px; border-top: 1px solid rgba(255,255,255,.1); }
    .response-btn { width: 100%; background: rgba(255,255,255,.05); border: 2px solid rgba(255,255,255,.2); color: #fff; padding: 15px; border-radius: 8px; cursor: pointer; text-align: left; transition: .3s; font-size: .95em; margin-bottom: 10px; }
    .response-btn:hover { background: rgba(227,6,19,.2); border-color: #E30613; transform: translateX(5px); }
    .response-btn.correct { background: rgba(72,187,120,.2); border-color: #48bb78; }
    .response-btn.incorrect { background: rgba(229,62,62,.2); border-color: #e53e3e; }
    .response-btn:disabled { cursor: not-allowed; opacity: .7; }
    .feedback { background: rgba(72,187,120,.1); border: 1px solid #48bb78; padding: 15px; border-radius: 8px; margin-top: 15px; }
    .feedback.negative { background: rgba(229,62,62,.1); border-color: #e53e3e; }
    .waiting-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; padding: 20px; }
  </style>
</head>
<body>
  <div class="header">
    <div class="logo">
      <div class="system-title">üöå RBS 2.0 - TRANSDEV COMMAND CENTER</div>
      <div class="training-indicator">TRAINING MODE</div>
    </div>
    <div class="header-stats">
      <div class="stat-badge ok"><span>‚úì</span><span id="activeCount">847</span><span>Actief</span></div>
      <div class="stat-badge warning"><span>‚ö†Ô∏è</span><span id="warningCount">0</span><span>Vertraagd</span></div>
      <div class="stat-badge critical"><span>üî¥</span><span id="criticalCount">0</span><span>Nood</span></div>
    </div>
    <div style="font-size:.85em;color:#a0aec0">
      <div>Score: <span id="score" style="color:#48bb78;font-weight:bold">0</span></div>
    </div>
  </div>

  <div class="main-container">
    <div class="sidebar">
      <div class="menu-item active" onclick="showStart()">üìû ROV Training</div>
      <div class="menu-item" onclick="alert('Dashboard komt binnenkort')">üìä Dashboard</div>
      <div class="menu-item" onclick="alert('Module in ontwikkeling')">üöå Voertuigen</div>
    </div>

    <div class="center-content">
      <div class="workspace-tabs">
        <div class="workspace-tab active">üìû Gesprek</div>
        <div class="workspace-tab" onclick="alert('Kaart functie komt binnenkort')">üó∫Ô∏è Kaart</div>
      </div>
      <div class="workspace-content" id="workspaceContent"></div>
    </div>

    <div class="right-panel">
      <div class="queue-header">
        <div class="queue-title"><span>üö®</span><span>Wachtrij</span><span class="queue-count" id="queueCount">0</span></div>
      </div>
      <div class="queue-list" id="queueList"></div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const INCIDENTS = {
      noodoproep1: {
        type: 'NOOD', priority: 1,
        caller: 'Chauffeur Rijken, Dennis (Lijn 320)',
        title: 'üö® MEDISCHE NOOD - REANIMATIE',
        location: 'Station Arnhem Zuid',
        conversation: [
          { sender: 'Chauffeur', text: 'ROV! SPOED! Passagier ligt op de grond, geen ademhaling! Iemand probeert te reanimeren!' }
        ],
        responses: [
          {
            text: 'Dennis, laat direct 112 bellen! Ik schakel S&V in, MER onderweg. Ritverval lijn 320 actief. Blijf bij slachtoffer!',
            correct: true,
            feedback: 'Perfect! Alle noodprocedures direct ingezet.',
            points: 150
          },
          {
            text: 'Rij met spoed naar het dichtstbijzijnde ziekenhuis!',
            correct: false,
            feedback: 'FOUT! Nooit vervoeren bij reanimatie. 112 ter plaatse!',
            points: -100
          },
          {
            text: 'Is er een AED in de buurt? Ga die halen!',
            correct: false,
            feedback: 'Verkeerde volgorde! Eerst 112, dan pas AED.',
            points: -50
          }
        ]
      },
      defect1: {
        type: 'DD', priority: 2,
        caller: 'Chauffeur Vosduilen, Jos (Lijn 320)',
        title: 'Motor defect - rookontwikkeling',
        location: 'A28 bij Huizen',
        conversation: [
          { sender: 'Chauffeur', text: 'Motor maakt vreemd geluid en ik zie rook! 38 passagiers aan boord. Wat moet ik doen?' }
        ],
        responses: [
          {
            text: 'Jos: DIRECT STOPPEN! Bij rook: bus evacueren. 112 voor brandweer. MER alarmerend. Monteur onderweg.',
            correct: true,
            feedback: 'Perfect protocol! Veiligheid voorop.',
            points: 120
          },
          {
            text: 'Probeer nog door te rijden naar de eindhalte.',
            correct: false,
            feedback: 'GEVAARLIJK! Rook = mogelijk brand. Direct stoppen!',
            points: -100
          },
          {
            text: 'Zet de verwarming uit, misschien helpt dat.',
            correct: false,
            feedback: 'Onvoldoende! Bij rook altijd stoppen en evacueren.',
            points: -60
          }
        ]
      },
      vertraging1: {
        type: 'VT', priority: 3,
        caller: 'Chauffeur Elbaaz, Borhan (Lijn 999)',
        title: 'Verkeersopstoppingen - 15min vertraging',
        location: 'A1 richting Huizen',
        conversation: [
          { sender: 'Chauffeur', text: 'Vastzittend in file A1. Al 15 minuten vertraging. Passagiers worden onrustig.' }
        ],
        responses: [
          {
            text: 'Borhan: Passagiers informeren. Ik update RBS realtime + app notificatie. Check overstap ritten. Doorrijden zodra mogelijk.',
            correct: true,
            feedback: 'Goed! Communicatie en realtime updates essentieel.',
            points: 80
          },
          {
            text: 'Gewoon doorrijden, vertraging halen we later wel in.',
            correct: false,
            feedback: 'Onrealistisch en passagiers blijven onwetend.',
            points: -40
          },
          {
            text: 'Neem een alternatieve route om tijd te winnen.',
            correct: false,
            feedback: 'Niet toegestaan zonder ROV toestemming!',
            points: -60
          }
        ]
      }
    };

    let score = 0;
    let currentIncident = null;
    let incidentQueue = [];

    function showStart() {
      document.getElementById('workspaceContent').innerHTML = `
        <div class="start-screen">
          <div class="start-title">üöå ROV TRAINING</div>
          <div class="start-description">
            <strong>Welkom bij de RBS 2.0 ROV Trainingsmodule</strong><br><br>
            Als Regionaal Operationeel Vervoer co√∂rdinator ben je verantwoordelijk voor het afhandelen van alle incidenten in het busvervoer netwerk.
            <br><br>
            Je krijgt realistische scenario's met echte procedures en beslissingen.
          </div>
          <div class="difficulty-selector">
            <div class="difficulty-btn" onclick="selectDifficulty(this)">üü¢<br>MAKKELIJK</div>
            <div class="difficulty-btn selected" onclick="selectDifficulty(this)">üü°<br>NORMAAL</div>
            <div class="difficulty-btn" onclick="selectDifficulty(this)">üî¥<br>EXPERT</div>
          </div>
          <button class="start-btn" onclick="startShift()">Start Shift</button>
        </div>
      `;
    }

    function selectDifficulty(el) {
      document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('selected'));
      el.classList.add('selected');
    }

    function startShift() {
      incidentQueue = [
        { ...INCIDENTS.noodoproep1, id: 'inc1', addedTime: Date.now() },
        { ...INCIDENTS.defect1, id: 'inc2', addedTime: Date.now() - 30000 },
        { ...INCIDENTS.vertraging1, id: 'inc3', addedTime: Date.now() - 60000 }
      ];
      updateQueue();
      showWaiting();
    }

    function updateQueue() {
      const list = document.getElementById('queueList');
      const count = document.getElementById('queueCount');
      count.textContent = incidentQueue.length;
      
      if (incidentQueue.length === 0) {
        list.innerHTML = '<div style="text-align:center;color:#48bb78;padding:20px">‚úì Wachtrij leeg!<br><button class="start-btn" onclick="showStart()" style="margin-top:15px;padding:10px 20px;font-size:1em">Nieuwe Shift</button></div>';
        return;
      }

      const now = Date.now();
      list.innerHTML = incidentQueue.map(inc => {
        const wt = Math.floor((now - inc.addedTime) / 1000);
        const disp = wt > 60 ? Math.floor(wt / 60) + ' min' : wt + ' sec';
        const title = inc.priority === 1 ? 'NOODOPROEP ‚Äì details onbekend' : inc.title;
        
        return `
          <div class="incident-card priority-${inc.priority}">
            <div class="incident-header">
              <span class="incident-type">${inc.type}</span>
              <span class="incident-time">‚è±Ô∏è ${disp}</span>
            </div>
            <div class="incident-title">${title}</div>
            <div class="incident-location">üìç ${inc.location}</div>
            <button class="accept-btn" onclick="acceptIncident('${inc.id}')">OPPAKKEN</button>
          </div>
        `;
      }).join('');

      document.getElementById('criticalCount').textContent = incidentQueue.filter(i => i.priority === 1).length;
      document.getElementById('warningCount').textContent = incidentQueue.filter(i => i.priority === 2).length;
    }

    function showWaiting() {
      document.getElementById('workspaceContent').innerHTML = `
        <div class="waiting-screen">
          <div style="font-size:4em">üìû</div>
          <h2>Selecteer een incident uit de wachtrij</h2>
          <p style="margin-top:15px">Wachtrij: ${incidentQueue.length} incidenten</p>
        </div>
      `;
    }

    function acceptIncident(id) {
      currentIncident = incidentQueue.find(i => i.id === id);
      incidentQueue = incidentQueue.filter(i => i.id !== id);
      updateQueue();
      displayIncident();
    }

    function displayIncident() {
      const inc = currentIncident;
      const ws = document.getElementById('workspaceContent');
      
      ws.innerHTML = `
        <div class="conversation-view">
          <div class="conversation-header">
            <div class="caller-info">${inc.priority === 1 ? 'üö® NOODOPROEP - ' : ''}${inc.caller}</div>
            <div class="call-timer">00:00</div>
          </div>
          <div class="conversation-messages">
            ${inc.conversation.map(m => `
              <div class="message">
                <div class="message-sender">${m.sender}</div>
                <div>${m.text}</div>
              </div>
            `).join('')}
          </div>
          <div class="response-options">
            ${inc.responses.map((r, idx) => `
              <button class="response-btn" onclick="selectResponse(${idx})">
                ${r.text}
              </button>
            `).join('')}
          </div>
        </div>
      `;
    }

    function selectResponse(index) {
      const r = currentIncident.responses[index];
      score += r.points;
      document.getElementById('score').textContent = score;
      
      document.querySelectorAll('.response-btn').forEach((b, i) => {
        b.disabled = true;
        if (currentIncident.responses[i].correct) {
          b.classList.add('correct');
        } else if (i === index && !r.correct) {
          b.classList.add('incorrect');
        }
      });

      const msgs = document.querySelector('.conversation-messages');
      msgs.innerHTML += `
        <div class="feedback ${r.correct ? '' : 'negative'}">
          <strong>${r.correct ? '‚úì CORRECT!' : '‚úó FOUT!'}</strong><br>
          ${r.feedback}<br><br>
          <strong>Punten: ${r.points > 0 ? '+' : ''}${r.points}</strong>
        </div>
      `;

      setTimeout(() => {
        document.querySelector('.response-options').innerHTML = `
          <button class="start-btn" onclick="nextIncident()">
            Volgende Incident (${incidentQueue.length} wachtend)
          </button>
        `;
      }, 1000);
    }

    function nextIncident() {
      currentIncident = null;
      if (incidentQueue.length > 0) {
        showWaiting();
      } else {
        document.getElementById('workspaceContent').innerHTML = `
          <div class="start-screen">
            <div class="start-title">SHIFT AFGEROND</div>
            <div style="font-size:3em;color:#48bb78;margin:20px 0">${score} punten</div>
            <div class="start-description">
              Goed werk! Je hebt alle incidenten afgehandeld.<br>
              Eindscore: ${score} punten
            </div>
            <button class="start-btn" onclick="showStart()">Nieuwe Shift</button>
          </div>
        `;
      }
    }

    // Start applicatie
    showStart();
  </script>
</body>
</html>
