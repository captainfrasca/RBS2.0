<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RBS Regalcentrum OV - Training Module</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f1419; color: #e0e0e0; height: 100vh; display: flex; flex-direction: column; font-size: 13px; }
    
    /* Header */
    .header { background: linear-gradient(to bottom, #1a1f2e 0%, #2d3748 100%); border-bottom: 3px solid #E30613; padding: 8px 12px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,.3); }
    .header-left { display: flex; align-items: center; gap: 20px; }
    .logo { color: #E30613; font-weight: bold; font-size: 11px; }
    .tabs { display: flex; gap: 5px; }
    .tab { padding: 4px 12px; background: #2d3748; border: 1px solid #4a5568; border-radius: 3px 3px 0 0; cursor: pointer; font-size: 11px; color: #a0aec0; }
    .tab.active { background: #1a202c; border-bottom: 1px solid #1a202c; margin-bottom: -1px; color: #fff; }
    .header-right { display: flex; gap: 10px; align-items: center; }
    .user-info { display: flex; align-items: center; gap: 8px; font-size: 11px; color: #a0aec0; }
    .training-badge { background: #f6ad55; color: #1a202c; padding: 3px 10px; border-radius: 12px; font-weight: bold; font-size: 10px; animation: pulse 2s infinite; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .7; } }
    
    /* Toolbar */
    .toolbar { background: #2d3748; border-bottom: 1px solid #4a5568; padding: 5px 8px; display: flex; gap: 8px; }
    .toolbar-btn { padding: 4px 10px; background: #1a202c; border: 1px solid #4a5568; border-radius: 3px; cursor: pointer; font-size: 11px; display: flex; align-items: center; gap: 4px; color: #e0e0e0; }
    .toolbar-btn:hover { background: rgba(227,6,19,.2); border-color: #E30613; }
    .toolbar-separator { width: 1px; background: #4a5568; margin: 0 4px; }
    
    /* Main Layout */
    .main-layout { flex: 1; display: grid; grid-template-columns: 280px 1fr 320px; gap: 6px; padding: 6px; overflow: hidden; background: #0a0e14; }
    
    /* Left Panel - Oproepen */
    .panel { background: #1a202c; border: 1px solid #2d3748; border-radius: 4px; display: flex; flex-direction: column; box-shadow: 0 1px 3px rgba(0,0,0,.3); }
    .panel-header { background: linear-gradient(to bottom, #2d3748 0%, #1a202c 100%); border-bottom: 1px solid #4a5568; padding: 6px 10px; font-weight: bold; font-size: 11px; color: #E30613; }
    .panel-content { flex: 1; overflow: auto; }
    
    /* Oproepen List */
    .call-list { display: flex; flex-direction: column; }
    .call-item { display: grid; grid-template-columns: 60px 40px 1fr 60px; gap: 4px; padding: 4px 6px; border-bottom: 1px solid #2d3748; font-size: 11px; align-items: center; cursor: pointer; color: #e0e0e0; }
    .call-item:hover { background: rgba(227,6,19,.1); }
    .call-item.selected { background: rgba(227,6,19,.3); font-weight: bold; }
    .call-item.priority-1 { background: rgba(227,6,19,.2); border-left: 4px solid #E30613; }
    .call-item.priority-2 { background: rgba(246,173,85,.1); border-left: 4px solid #f6ad55; }
    .call-type { font-weight: bold; color: #E30613; }
    
    /* Center Panel - Events & Details */
    .events-panel { display: flex; flex-direction: column; }
    .events-table { flex: 1; overflow: auto; background: #1a202c; }
    .table-header { background: linear-gradient(to bottom, #2d3748 0%, #1a202c 100%); border-bottom: 2px solid #E30613; display: grid; grid-template-columns: 60px 300px 60px 100px 180px 1fr; font-size: 11px; font-weight: bold; padding: 4px 6px; position: sticky; top: 0; color: #E30613; }
    .table-row { display: grid; grid-template-columns: 60px 300px 60px 100px 180px 1fr; font-size: 11px; padding: 3px 6px; border-bottom: 1px solid #2d3748; align-items: center; color: #e0e0e0; }
    .table-row:nth-child(even) { background: rgba(255,255,255,.02); }
    .table-row.warning { background: rgba(246,173,85,.1); }
    .status-icon { display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; border-radius: 3px; font-size: 10px; font-weight: bold; }
    .status-icon.critical { background: #E30613; color: white; }
    .status-icon.warning { background: #f6ad55; color: #1a202c; }
    
    /* Conversation Area */
    .conversation-area { background: #1a202c; border: 1px solid #2d3748; border-radius: 4px; margin-top: 6px; height: 350px; display: flex; flex-direction: column; }
    .conversation-header { background: linear-gradient(to bottom, #2d3748 0%, #1a202c 100%); border-bottom: 1px solid #4a5568; padding: 8px 12px; display: flex; justify-content: space-between; align-items: center; }
    .caller-name { font-weight: bold; color: #E30613; font-size: 12px; }
    .call-duration { font-size: 11px; color: #48bb78; }
    .conversation-messages { flex: 1; overflow-y: auto; padding: 12px; background: #0f1419; }
    .message { margin-bottom: 12px; }
    .message-header { font-size: 10px; color: #a0aec0; margin-bottom: 3px; display: flex; justify-content: space-between; }
    .message-content { background: #1a202c; border: 1px solid #2d3748; border-radius: 4px; padding: 8px; font-size: 12px; line-height: 1.5; color: #e0e0e0; }
    .message.from-chauffeur .message-content { background: rgba(246,173,85,.1); border-left: 3px solid #f6ad55; }
    .message.from-rov .message-content { background: rgba(33,150,243,.1); border-left: 3px solid #2196f3; }
    .message.system .message-content { background: rgba(255,255,255,.05); border-left: 3px solid #718096; font-style: italic; color: #a0aec0; }
    
    /* Response Options */
    .response-options { padding: 10px; background: #2d3748; border-top: 1px solid #4a5568; }
    .response-btn { width: 100%; padding: 10px; margin-bottom: 6px; background: #1a202c; border: 1px solid #4a5568; border-radius: 3px; text-align: left; cursor: pointer; font-size: 11px; transition: all .2s; color: #e0e0e0; }
    .response-btn:hover { background: rgba(227,6,19,.2); border-color: #E30613; transform: translateX(3px); }
    .response-btn.correct { background: rgba(72,187,120,.2); border-color: #48bb78; font-weight: bold; }
    .response-btn.incorrect { background: rgba(227,6,19,.2); border-color: #E30613; }
    .response-btn:disabled { cursor: not-allowed; opacity: .7; }
    .feedback { background: rgba(72,187,120,.1); border: 2px solid #48bb78; border-radius: 4px; padding: 12px; margin-top: 8px; font-size: 11px; color: #e0e0e0; }
    .feedback.negative { background: rgba(227,6,19,.1); border-color: #E30613; }
    
    /* Right Panel - Queue */
    .queue-item { padding: 8px; margin: 6px; background: #2d3748; border: 1px solid #4a5568; border-left: 4px solid #2196f3; border-radius: 3px; cursor: pointer; }
    .queue-item:hover { background: rgba(33,150,243,.1); }
    .queue-item.priority-1 { border-left-color: #E30613; background: rgba(227,6,19,.1); animation: urgentPulse 2s infinite; }
    .queue-item.priority-2 { border-left-color: #f6ad55; background: rgba(246,173,85,.05); }
    @keyframes urgentPulse { 0%, 100% { box-shadow: 0 0 0 0 rgba(227,6,19,0); } 50% { box-shadow: 0 0 8px 2px rgba(227,6,19,.4); } }
    .queue-header-text { display: flex; justify-content: space-between; font-size: 10px; margin-bottom: 4px; color: #a0aec0; }
    .queue-title { font-weight: bold; font-size: 11px; margin-bottom: 3px; color: #e0e0e0; }
    .queue-location { font-size: 10px; color: #a0aec0; }
    .queue-btn { margin-top: 6px; padding: 4px 8px; background: #48bb78; color: #1a202c; border: none; border-radius: 3px; cursor: pointer; width: 100%; font-size: 10px; font-weight: bold; }
    .queue-btn:hover { background: #38a169; }
    
    /* Start Screen */
    .start-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; padding: 30px; background: #1a202c; }
    .start-title { font-size: 24px; font-weight: bold; color: #E30613; margin-bottom: 15px; }
    .start-desc { text-align: center; max-width: 600px; margin-bottom: 25px; line-height: 1.6; color: #a0aec0; }
    .difficulty-select { display: flex; gap: 15px; margin: 20px 0; }
    .diff-btn { padding: 15px 25px; border: 2px solid #4a5568; border-radius: 5px; cursor: pointer; background: #2d3748; transition: all .2s; color: #e0e0e0; }
    .diff-btn:hover { border-color: #E30613; transform: translateY(-2px); }
    .diff-btn.selected { border-color: #E30613; background: rgba(227,6,19,.2); font-weight: bold; }
    .start-btn { padding: 12px 40px; background: #E30613; color: white; border: none; border-radius: 4px; font-size: 14px; font-weight: bold; cursor: pointer; margin-top: 20px; }
    .start-btn:hover { background: #cc0510; }
    
    /* Trip Info Card */
    .trip-card { background: rgba(33,150,243,.1); border: 1px solid #2196f3; border-radius: 4px; padding: 10px; margin: 10px 12px; font-size: 11px; }
    .trip-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 6px; }
    .trip-field { display: flex; flex-direction: column; }
    .trip-label { color: #a0aec0; font-size: 9px; text-transform: uppercase; }
    .trip-value { font-weight: bold; color: #E30613; }
    .trip-route { background: #2d3748; padding: 6px; border-radius: 3px; margin-top: 6px; border-left: 3px solid #2196f3; color: #e0e0e0; }
  </style>
</head>
<body>
  <div class="header">
    <div class="header-left">
      <div class="logo">üöç RBS Regalcentrum OV - AML 1 ‚Ä¢ AML 2 ‚Ä¢ AML 3</div>
      <div class="tabs">
        <div class="tab active">Bestand</div>
        <div class="tab">Meldingen</div>
        <div class="tab">Verkeersberichten</div>
        <div class="tab">Dienstberichten</div>
      </div>
    </div>
    <div class="header-right">
      <div class="training-badge">TRAINING MODUS</div>
      <div class="user-info">
        <span>üë§ Gebruiker: <strong>Trainingsoefening</strong></span>
        <span>|</span>
        <span>Score: <strong id="scoreDisplay">0</strong></span>
      </div>
    </div>
  </div>

  <div class="toolbar">
    <button class="toolbar-btn">üìû Actie vereist van Chauffeur</button>
    <button class="toolbar-btn">üìã Afgesloten</button>
    <div class="toolbar-separator"></div>
    <button class="toolbar-btn">üîÑ Vernieuwen</button>
    <button class="toolbar-btn">üìä Overzicht</button>
  </div>

  <div class="main-layout">
    <!-- Left Panel: Oproepen -->
    <div class="panel">
      <div class="panel-header">Oproepen</div>
      <div class="panel-content">
        <div style="padding: 8px; border-bottom: 1px solid #e0e0e0; background: #f8f8f8;">
          <div style="display: grid; grid-template-columns: 60px 40px 1fr 60px; gap: 4px; font-size: 10px; font-weight: bold; color: #666;">
            <div>Voertuig</div>
            <div>Type</div>
            <div>Omloop / Chauffeur</div>
            <div>Ontvangen</div>
          </div>
        </div>
        <div class="call-list" id="callList"></div>
      </div>
      <div style="padding: 8px; border-top: 1px solid #ccc; background: #f0f0f0;">
        <div style="font-size: 10px; color: #666;">
          <strong>Startdief:</strong> Chauffeur ‚Ä¢ <strong>Diensten:</strong> Gesignaleerd ‚Ä¢ <strong>Aanmelding!</strong>
        </div>
      </div>
    </div>

    <!-- Center Panel: Events & Conversation -->
    <div class="panel">
      <div class="panel-header">Events / Gesprekken</div>
      <div class="panel-content" id="centerContent"></div>
    </div>

    <!-- Right Panel: Wachtrij -->
    <div class="panel">
      <div class="panel-header">
        Incidenten Wachtrij
        <span style="float: right; background: #c00; color: white; padding: 2px 8px; border-radius: 10px; font-size: 10px;" id="queueCount">0</span>
      </div>
      <div class="panel-content" id="queueList"></div>
    </div>
  </div>

  <script>
    const INCIDENTS = {
      nood1: {
        type: 'NOOD', priority: 1, voertuig: '270251',
        caller: 'Chauffeur Rijken, Dennis',
        lijn: '320', rit: '6084', omloop: '610+03', dienst: '616516',
        location: 'Station Arnhem Zuid', vestiging: 'Haarlem H3M (61)',
        title: 'MEDISCHE NOOD',
        initialMessage: 'ROV! ROV! SPOED! Er ligt een passagier op de grond! Hij reageert niet meer, ik zie geen ademhaling! Iemand is bezig met reanimatie!',
        conversation: [
          { type: 'system', text: 'Melding ontvangen: NOODOPROEP - Medisch incident' },
          { sender: 'Chauffeur Rijken, Dennis', text: 'ROV! ROV! SPOED! Er ligt een passagier op de grond! Hij reageert niet meer, ik zie geen ademhaling! Iemand is bezig met reanimatie!', time: '00:00' }
        ],
        questions: [
          {
            situation: 'De chauffeur meldt panisch dat een passagier niet reageert en niet ademt. Iemand is bezig met reanimeren.',
            rovOptions: [
              { 
                question: 'Dennis, ok√©, ik hoor je. Blijf rustig. Ben jij zelf veilig? Hoeveel passagiers zitten er in de bus?',
                correct: true,
                feedback: 'CORRECT! Eerst chauffeur kalmeren en veiligheid checken. Dan informatie verzamelen.',
                chauffeurResponse: 'Ja, ik sta veilig. Ongeveer 40 passagiers. Een vrouw is nu aan het reanimeren!'
              },
              { 
                question: 'Dennis, rijd direct naar het ziekenhuis!',
                correct: false,
                feedback: 'FOUT! NOOIT vervoeren bij reanimatie. Ambulance komt ter plaatse!',
                chauffeurResponse: 'Moet ik echt gaan rijden met iemand die wordt gereanimeerd?!'
              },
              {
                question: 'Waar is de AED? Pak die nu!',
                correct: false,
                feedback: 'TE SNEL! Eerst situatie inschatten en 112 checken. Dan pas AED.',
                chauffeurResponse: 'Weet niet waar die is... moet ik nu echt gaan zoeken?'
              }
            ]
          },
          {
            situation: 'De chauffeur is veilig. 40 passagiers. Iemand reaniŒºmeert de passagier.',
            rovOptions: [
              {
                question: 'Goed Dennis. Laat die vrouw doorgaan met reanimeren, niet stoppen. Heeft iemand al 112 gebeld?',
                correct: true,
                feedback: 'GOED! Reanimatie mag niet stoppen. 112 status is cruciaal.',
                chauffeurResponse: 'Ja, iemand heeft 112 gebeld. Ambulance is onderweg!'
              },
              {
                question: 'Probeer de persoon wakker te schudden!',
                correct: false,
                feedback: 'GEVAARLIJK! Nooit reanimatie onderbreken. Laat hulpverlener doorwerken.',
                chauffeurResponse: 'Die vrouw zegt dat ik niet moet storen!'
              },
              {
                question: 'Hoelang duurt het al? Hoe ziet hij eruit?',
                correct: false,
                feedback: 'NIET PRIORITEIT! Eerst hulpdiensten en AED. Details komen later.',
                chauffeurResponse: 'Geen idee, paar minuten? Hij is blauw...'
              }
            ]
          },
          {
            situation: '112 is gebeld, ambulance onderweg. Reanimatie loopt.',
            rovOptions: [
              {
                question: 'Dennis, is er een AED in de bus? Zo ja, laat iemand die pakken en aansluiten. Ik schakel nu S&V in en regel MER voor vervangbus.',
                correct: true,
                feedback: 'UITSTEKEND! AED kan levens redden. S&V en MER parallel inschakelen.',
                chauffeurResponse: 'Ja, iemand heeft de AED al gepakt en aangesloten!'
              },
              {
                question: 'Hoelang duurt het nog voordat de ambulance er is?',
                correct: false,
                feedback: 'NIET NUTTIG! Chauffeur weet dit niet. Focus op wat WIJ kunnen doen: AED, S&V, MER.',
                chauffeurResponse: 'Geen idee, ze hebben niks gezegd...'
              },
              {
                question: 'Blijf gewoon rustig, ambulance komt eraan.',
                correct: false,
                feedback: 'TE WEINIG! Je moet actief AED vragen en S&V/MER inschakelen.',
                chauffeurResponse: 'Ok√©... moet ik verder niks doen?'
              }
            ]
          },
          {
            situation: 'AED is aangesloten. S&V en MER zijn gealarmeerd. Ambulance onderweg.',
            rovOptions: [
              {
                question: 'Dennis, waar staat de bus precies? Geef me een duidelijke locatie zodat ambulance je snel vindt.',
                correct: true,
                feedback: 'GOED! Precieze locatie is essentieel voor snelle hulp.',
                chauffeurResponse: 'Station Arnhem Zuid, bushalte perron 3, aan de kant van het station.'
              },
              {
                question: 'Laat de andere passagiers uitstappen, dat geeft meer ruimte.',
                correct: false,
                feedback: 'NIET NUTTIG! Reanimatieruimte is voldoende. Passagiers uitlaten kost tijd en overzicht.',
                chauffeurResponse: 'Moet dat echt? Is al zo\'n chaos hier...'
              },
              {
                question: 'Kun je al iets zien bewegen bij het slachtoffer?',
                correct: false,
                feedback: 'NIET RELEVANT! Focus op acties (locatie, ritverval), niet op medische observatie.',
                chauffeurResponse: 'Nee, niks... ligt nog steeds stil...'
              }
            ]
          },
          {
            situation: 'Locatie is doorgegeven. Ambulance weet waar ze moeten zijn.',
            rovOptions: [
              {
                question: 'Dennis, blijf waar je bent tot ambulance er is. Ik registreer nu ritverval lijn 320 rit 6084. Houd mij op de hoogte van veranderingen.',
                correct: true,
                feedback: 'PERFECT! Chauffeur blijft ter plaatse. Ritverval registreren. Communicatielijn open.',
                chauffeurResponse: 'Ok√©, ik blijf hier. Ik hoor de sirene al aankomen!'
              },
              {
                question: 'Kun je straks een verklaring schrijven van wat er gebeurd is?',
                correct: false,
                feedback: 'TE VROEG! Eerst incident afhandelen. Rapportage komt later via S&V.',
                chauffeurResponse: 'Nu? Moet ik daar nu aan denken?'
              },
              {
                question: 'Roep om dat de bus vertraging heeft.',
                correct: false,
                feedback: 'ONZINNIG! Bij noodoproep geen omroepen. Alle focus op het slachtoffer.',
                chauffeurResponse: 'Moet ik echt omroepen nu? Er ligt iemand te sterven!'
              }
            ]
          }
        ],
        finalQuestion: {
          question: 'Wat is de COMPLETE ROV-actie na dit gesprek?',
          options: [
            {
              text: '‚úì 112 bevestigd, S&V gealarmeerd, MER ingezet voor vervangbus, Ritverval lijn 320 rit 6084 geregistreerd, Chauffeur blijft ter plaatse, Precieze locatie doorgegeven',
              correct: true,
              feedback: 'EXCELLENT! Alle cruciale stappen:\n- 112 bevestigd\n- S&V ge√Ønformeerd (verplicht bij medisch)\n- MER ingezet\n- Ritverval geregistreerd\n- Chauffeur ter plaatse\n- Locatie accuraat',
              points: 200
            },
            {
              text: 'Chauffeur vragen om naar het ziekenhuis te rijden met het slachtoffer',
              correct: false,
              feedback: 'LEVENSGEVAARLIJK! Bij reanimatie NOOIT vervoeren. Ambulance ter plaatse. Beweging kan fataal zijn!',
              points: -150
            },
            {
              text: 'Alleen MER sturen, verder afwachten',
              correct: false,
              feedback: 'ONVOLDOENDE! S&V MOET bij medische nood. Ook ritverval registreren en locatie checken.',
              points: -100
            },
            {
              text: 'Chauffeur vragen of passagiers ge√Ønformeerd zijn over de vertraging',
              correct: false,
              feedback: 'VERKEERDE PRIORITEIT! Bij noodoproep gaat ALLES om het slachtoffer, niet om reizigers informeren.',
              points: -120
            }
          ]
        }
      },
      
      defect1: {
        type: 'DD', priority: 2, voertuig: '270456',
        caller: 'Chauffeur Vosduilen, Jos',
        lijn: '999', rit: '4295', omloop: '173+10', dienst: '173510',
        location: 'A28 ter hoogte Huizen', vestiging: 'Arnhem (GLD)',
        title: 'Motor defect',
        initialMessage: 'ROV, de motor maakt een vreemd geluid en ik zie rook komen onder de motorkap!',
        conversation: [
          { type: 'system', text: 'Melding ontvangen: Voertuigdefect Dringend' },
          { sender: 'Chauffeur Vosduilen, Jos', text: 'ROV, de motor maakt een vreemd geluid en ik zie rook komen onder de motorkap!', time: '00:00' }
        ],
        questions: [
          {
            situation: 'De chauffeur meldt dat de motor vreemd geluid maakt en er rook onder de motorkap komt.',
            rovOptions: [
              {
                question: 'Jos, allereerst: rijd je nog of sta je al stil? Hoeveel passagiers heb je aan boord?',
                correct: true,
                feedback: 'CORRECT! Eerst veiligheid checken: stilstand en aantal passagiers.',
                chauffeurResponse: 'Ik ben net gestopt op de vluchtstrook. 38 passagiers aan boord.'
              },
              {
                question: 'Jos, probeer nog een keer gas te geven, misschien trekt het bij.',
                correct: false,
                feedback: 'GEVAARLIJK! Bij rook NOOIT doorrijden of gas geven. Direct stoppen!',
                chauffeurResponse: 'Moet ik echt gas geven? De rook wordt nu erger...'
              },
              {
                question: 'Kun je zelf even kijken wat er aan de hand is onder de motorkap?',
                correct: false,
                feedback: 'NIET TOEGESTAAN! Chauffeur mag nooit zelf aan motor. Monteur komt.',
                chauffeurResponse: 'Mag ik dat zelf? Weet niet of dat veilig is...'
              }
            ]
          },
          {
            situation: 'De chauffeur staat stil op de vluchtstrook met 38 passagiers. Er komt rook onder de motorkap.',
            rovOptions: [
              {
                question: 'Goed Jos. Zie je vlammen of is het alleen rook? Staan je waarschuwingslichten aan?',
                correct: true,
                feedback: 'GOED! Ernst inschatten (vlammen vs rook) en veiligheidsmaatregelen checken.',
                chauffeurResponse: 'Alleen rook, geen vlammen. Waarschuwingslichten staan aan.'
              },
              {
                question: 'Jos, rij de bus naar de dichtstbijzijnde parkeerplaats.',
                correct: false,
                feedback: 'FOUT! Bij rook NIET meer rijden. Blijf waar je bent! Kan brand worden.',
                chauffeurResponse: 'Moet ik echt rijden met rook? Lijkt me gevaarlijk...'
              },
              {
                question: 'Hoelang maakt de motor al dat geluid?',
                correct: false,
                feedback: 'NIET PRIORITEIT! Eerst ernst inschatten en veiligheid. Historie is later.',
                chauffeurResponse: 'Eh... een paar minuten denk ik?'
              }
            ]
          },
          {
            situation: 'Alleen rook, geen vlammen. Waarschuwingslichten staan aan. Bus staat veilig.',
            rovOptions: [
              {
                question: 'Jos, wordt de rook meer of blijft het stabiel? Moeten de passagiers eruit voor de veiligheid?',
                correct: true,
                feedback: 'GOED! Ontwikkeling monitoren en evacuatiebeslissing maken.',
                chauffeurResponse: 'Rook blijft ongeveer hetzelfde. Passagiers kunnen denk ik binnen blijven, wel onrustig.'
              },
              {
                question: 'Zet de motor uit en weer aan, dat helpt soms.',
                correct: false,
                feedback: 'GEVAARLIJK! Nooit motor herstarten bij rook. Kan brand veroorzaken!',
                chauffeurResponse: 'Is dat veilig met rook? Durf ik niet...'
              },
              {
                question: 'Vraag aan passagiers of iemand verstand heeft van motoren.',
                correct: false,
                feedback: 'ONPROFESSIONEEL! Passagiers mogen niet aan het voertuig. Monteur komt.',
                chauffeurResponse: 'Echt? Mogen ze dat dan?'
              }
            ]
          },
          {
            situation: 'Rook is stabiel. Passagiers kunnen vooralsnog in de bus blijven.',
            rovOptions: [
              {
                question: 'Ok√© Jos. Ik schakel nu monteur SPOED in, MER met vervangbus is onderweg, en ik bel Rijkswaterstaat. Waar staat je precies op de A28?',
                correct: true,
                feedback: 'PERFECT! Alle partijen inschakelen en precieze locatie vragen.',
                chauffeurResponse: 'A28, hectometerpaal 45.2, vluchtstrook na afslag Huizen.'
              },
              {
                question: 'Blijf gewoon wachten, er komt zo wel iemand langs.',
                correct: false,
                feedback: 'TE VAAG! Je moet actief monteur, MER en Rijkswaterstaat inschakelen.',
                chauffeurResponse: 'Wanneer ongeveer? Passagiers worden ongeduldig...'
              },
              {
                question: 'Zeg tegen de passagiers dat het niet lang duurt.',
                correct: false,
                feedback: 'NIET NUTTIG! Focus op hulp regelen, niet op verwachtingen managen.',
                chauffeurResponse: 'Wat moet ik dan zeggen als ze vragen hoe lang het duurt?'
              }
            ]
          },
          {
            situation: 'Monteur, MER en Rijkswaterstaat zijn gealarmeerd. Locatie is doorgegeven.',
            rovOptions: [
              {
                question: 'Jos, ik registreer nu ritverval lijn 999 rit 4295. Monteur ETA 15 minuten, MER 20 minuten. Blijf in of bij de bus en bel mij direct als de situatie verandert.',
                correct: true,
                feedback: 'UITSTEKEND! Ritverval, ETA communiceren, instructie geven.',
                chauffeurResponse: 'Begrepen. Ik blijf hier en houd het in de gaten.'
              },
              {
                question: 'Je mag wel even uitstappen om de benen te strekken.',
                correct: false,
                feedback: 'ONVERSTANDIG! Chauffeur moet bij bus blijven voor hulpdiensten en wijzigingen.',
                chauffeurResponse: 'Moet ik niet bij de bus blijven voor als er wat gebeurt?'
              },
              {
                question: 'Kun je intussen al een storing rapport invullen?',
                correct: false,
                feedback: 'TE VROEG! Eerst incident afhandelen. Rapportage komt later.',
                chauffeurResponse: 'Nu al? Moet ik niet eerst focussen op de situatie hier?'
              }
            ]
          }
        ],
        finalQuestion: {
          question: 'Wat is de CORRECTE ROV-actie bij dit motordefect?',
          options: [
            {
              text: '‚úì Monteur SPOED, MER met vervangbus, Rijkswaterstaat informeren, Ritverval 999 rit 4295, Bij verslechtering: 112 brandweer, ETA doorgeven aan chauffeur',
              correct: true,
              feedback: 'CORRECT! Volledige procedure:\n- Monteur spoed (technisch)\n- MER (passagiers)\n- Rijkswaterstaat (verkeer)\n- Ritverval (administratie)\n- 112 standby (veiligheid)\n- ETA communicatie',
              points: 150
            },
            {
              text: 'Jos vragen om zelf te kijken wat er mis is met de motor',
              correct: false,
              feedback: 'GEVAARLIJK! Chauffeur mag NOOIT zelf aan motor. Alleen monteur!',
              points: -120
            },
            {
              text: 'Chauffeur vragen om door te rijden naar werkplaats',
              correct: false,
              feedback: 'LEVENSGEVAARLIJK! Rook = mogelijk brand. NOOIT doorrijden. Bus blijft staan!',
              points: -100
            },
            {
              text: 'Alleen MER sturen voor passagiers, monteur kan later',
              correct: false,
              feedback: 'ONVOLLEDIG! Monteur SPOED nodig bij rook. Ook Rijkswaterstaat informeren (snelweg).',
              points: -80
            }
          ]
        }
      },

      vertraging1: {
        type: 'VT', priority: 3, voertuig: '270253',
        caller: 'Chauffeur Elbaaz, Borhan',
        lijn: '320', rit: '6118', omloop: '270+56', dienst: '271530',
        location: 'A1 - file richting Huizen', vestiging: 'Huizen (27)',
        title: 'File - vertraging',
        initialMessage: 'ROV, ik sta al 15 minuten stil in een file op de A1. Passagiers beginnen te klagen over vertraging.',
        conversation: [
          { type: 'system', text: 'Melding ontvangen: Vertraging - File' },
          { sender: 'Chauffeur Elbaaz, Borhan', text: 'ROV, ik sta al 15 minuten stil in een file op de A1. Passagiers beginnen te klagen over vertraging.', time: '00:00' }
        ],
        questions: [
          {
            situation: 'De chauffeur staat 15 minuten in de file. Passagiers zijn onrustig.',
            rovOptions: [
              {
                question: 'Borhan, hoeveel minuten vertraging heb je nu opgelopen? Zie je al beweging in de file?',
                correct: true,
                feedback: 'GOED! Exacte vertraging vaststellen en situatie inschatten.',
                chauffeurResponse: 'Ongeveer 17 minuten nu. File staat nog helemaal stil, geen beweging.'
              },
              {
                question: 'Neem een alternatieve route om tijd te winnen.',
                correct: false,
                feedback: 'NIET TOEGESTAAN! Alleen ROV mag alternatieve routes bepalen na analyse, niet chauffeur zelf.',
                chauffeurResponse: 'Welke route dan? Ik ken hier niet alle wegen...'
              },
              {
                question: 'Hoelang denk je dat het nog duurt?',
                correct: false,
                feedback: 'NIET NUTTIG! Chauffeur kan dat niet inschatten. JIJ moet verkeersinformatie checken.',
                chauffeurResponse: 'Geen idee, ik kan niet in de toekomst kijken...'
              }
            ]
          },
          {
            situation: '17 minuten vertraging, file staat volledig stil.',
            rovOptions: [
              {
                question: 'Ok√© Borhan. Zijn er passagiers die een belangrijke overstap moeten halen, zoals een trein of andere bus?',
                correct: true,
                feedback: 'CORRECT! Aansluitingen zijn cruciaal. Bij gemiste overstappen kunnen we maatregelen nemen.',
                chauffeurResponse: 'Ja, een paar mensen moeten de trein van 14:23 halen in Huizen.'
              },
              {
                question: 'Roep om dat ze geduld moeten hebben.',
                correct: false,
                feedback: 'NIET NUTTIG! Dit helpt chauffeur niet en lost niks op. Focus op acties.',
                chauffeurResponse: 'Dat gaat ze niet blij maken...'
              },
              {
                question: 'Blijf gewoon wachten, komt wel goed.',
                correct: false,
                feedback: 'TE PASSIEF! Je moet actie ondernemen: verkeersinformatie, alternatieve route, aansluitingen.',
                chauffeurResponse: 'Ja maar wat moet ik tegen de mensen zeggen?'
              }
            ]
          },
          {
            situation: 'Enkele passagiers moeten trein 14:23 halen. File staat nog steeds stil.',
            rovOptions: [
              {
                question: 'Ik check nu verkeersinformatie voor alternatieve route. Hoeveel minuten tot jouw geplande aankomst in Huizen?',
                correct: true,
                feedback: 'GOED! Verkeersinformatie checken en tijdsberekening maken voor beslissing.',
                chauffeurResponse: 'Volgens planning zou ik er over 12 minuten moeten zijn.'
              },
              {
                question: 'Probeer via de vluchtstrook te rijden.',
                correct: false,
                feedback: 'ILLEGAAL! Vluchtstrook is alleen voor hulpdiensten. Chauffeur krijgt boete.',
                chauffeurResponse: 'Mag dat dan? Lijkt me niet toegestaan...'
              },
              {
                question: 'Zeg dat ze een latere trein moeten nemen.',
                correct: false,
                feedback: 'NIET JOUW TAAK! Passagiers bepalen zelf hun reis. Jij regelt vervoer.',
                chauffeurResponse: 'Kan ik dat zomaar zeggen?'
              }
            ]
          },
          {
            situation: 'Geplande aankomst over 12 minuten. Trein vertrekt 14:23. Met vertraging niet haalbaar.',
            rovOptions: [
              {
                question: 'Borhan, ik zie een alternatieve route via de N201. Kost 5 minuten langer normaal, maar nu sneller dan de file. Neem afslag Huizen-West over 800 meter.',
                correct: true,
                feedback: 'UITSTEKEND! Alternatieve route met duidelijke instructie. ROV beslist, chauffeur voert uit.',
                chauffeurResponse: 'Begrepen, afslag Huizen-West over 800 meter. Bedankt!'
              },
              {
                question: 'Blijf in de file, het trekt vast wel bij.',
                correct: false,
                feedback: 'SLECHTE KEUZE! File staat al 17 min stil. Alternatieve route is beter.',
                chauffeurResponse: 'Ok√©, maar mensen missen wel hun trein...'
              },
              {
                question: 'Vraag aan de passagiers wat ze willen.',
                correct: false,
                feedback: 'ONPROFESSIONEEL! ROV maakt routebeslissingen, niet passagiers.',
                chauffeurResponse: 'Dan krijg ik 30 verschillende antwoorden...'
              }
            ]
          },
          {
            situation: 'Alternatieve route is gegeven. Chauffeur neemt afslag Huizen-West.',
            rovOptions: [
              {
                question: 'Borhan, ik registreer ritverval en nieuwe route. ETA nu 14:20, trein kan gehaald worden. Bel me als je er bent.',
                correct: true,
                feedback: 'PERFECT! Ritverval registreren, nieuwe ETA communiceren, afsluiting professioneel.',
                chauffeurResponse: 'Top, ik rij nu via de N201. Lijkt inderdaad sneller.'
              },
              {
                question: 'Rij zo hard mogelijk om de vertraging in te halen.',
                correct: false,
                feedback: 'GEVAARLIJK! Veiligheid gaat altijd voor. Binnen snelheidslimiet blijven.',
                chauffeurResponse: 'Dat is toch niet veilig met passagiers?'
              },
              {
                question: 'Sla nog wat haltes over om tijd te winnen.',
                correct: false,
                feedback: 'NIET TOEGESTAAN! Alle haltes moeten bediend worden volgens dienstregeling.',
                chauffeurResponse: 'Mag ik dat zomaar beslissen?'
              }
            ]
          }
        ],
        finalQuestion: {
          question: 'Wat is de CORRECTE ROV-actie bij deze vertraging?',
          options: [
            {
              text: '‚úì Verkeersinformatie checken, Aansluitingen controleren, Alternatieve route bepalen en instructie geven, Ritverval registreren met nieuwe route, ETA communiceren',
              correct: true,
              feedback: 'CORRECT! Complete procedure:\n- Verkeersinformatie (oorzaak & alternatieven)\n- Aansluitingen (impact passagiers)\n- Route besluit (ROV bepaalt, niet chauffeur)\n- Ritverval (administratie)\n- ETA (verwachting)',
              points: 100
            },
            {
              text: 'Niets doen, is gewoon file, gebeurt vaker',
              correct: false,
              feedback: 'FOUT! Bij structurele vertraging moet je actie ondernemen. Verkeer checken, alternatieven zoeken.',
              points: -80
            },
            {
              text: 'Chauffeur zelf een andere route laten kiezen',
              correct: false,
              feedback: 'NIET TOEGESTAAN! Alleen ROV bepaalt alternatieve routes na verkeersanalyse. Chauffeur voert uit.',
              points: -60
            },
            {
              text: 'Chauffeur vragen om passagiers te informeren over de vertraging',
              correct: false,
              feedback: 'NIET RELEVANT! Passagierscommunicatie is niet jouw taak. Focus op vervoer regelen.',
              points: -70
            }
          ]
        }
      }
    };

    let score = 0;
    let currentIncident = null;
    let currentQuestionIndex = 0;
    let incidentQueue = [];
    let callTimer = null;

    function showStart() {
      document.getElementById('centerContent').innerHTML = `
        <div class="start-screen">
          <div class="start-title">RBS Training Module</div>
          <div class="start-desc">
            Welkom bij de ROV (Regionale Operationeel Vervoer) trainingsmodule.<br><br>
            Je gaat realistische gesprekken voeren met chauffeurs en de juiste vragen stellen zoals in het echte RBS systeem.
            <br><br>
            <strong>Let op:</strong> Bij noodoproepen moet je kalm blijven, de juiste informatie verzamelen en correcte acties uitvoeren.
          </div>
          <div class="difficulty-select">
            <div class="diff-btn selected">Normaal</div>
          </div>
          <button class="start-btn" onclick="startShift()">Start Training Shift</button>
        </div>
      `;
    }

    function startShift() {
      incidentQueue = [
        { ...INCIDENTS.nood1, id: 'inc1', addedTime: Date.now() },
        { ...INCIDENTS.defect1, id: 'inc2', addedTime: Date.now() - 45000 },
        { ...INCIDENTS.vertraging1, id: 'inc3', addedTime: Date.now() - 120000 }
      ];
      updateCallList();
      updateQueue();
      showWaiting();
    }

    function updateCallList() {
      const list = document.getElementById('callList');
      const processed = incidentQueue.filter(inc => inc.id !== (currentIncident?.id));
      
      list.innerHTML = processed.map(inc => {
        const time = Math.floor((Date.now() - inc.addedTime) / 1000);
        const timeStr = time < 60 ? time + 's' : Math.floor(time/60) + 'm';
        
        return `
          <div class="call-item priority-${inc.priority}" onclick="acceptIncident('${inc.id}')">
            <div>${inc.voertuig}</div>
            <div class="call-type">${inc.type}</div>
            <div style="font-size: 10px;">${inc.omloop}<br>${inc.caller}</div>
            <div style="color: ${time > 120 ? '#c00' : '#666'};">${timeStr}</div>
          </div>
        `;
      }).join('');
    }

    function updateQueue() {
      const list = document.getElementById('queueList');
      const count = document.getElementById('queueCount');
      count.textContent = incidentQueue.length;
      
      if (incidentQueue.length === 0) {
        list.innerHTML = '<div style="padding: 20px; text-align: center; color: #4caf50;">‚úì Alle incidenten afgehandeld</div>';
        return;
      }

      const now = Date.now();
      list.innerHTML = incidentQueue.map(inc => {
        const wt = Math.floor((now - inc.addedTime) / 1000);
        const timeStr = wt < 60 ? wt + ' sec' : Math.floor(wt/60) + ' min';
        
        return `
          <div class="queue-item priority-${inc.priority}">
            <div class="queue-header-text">
              <span style="color: #c00; font-weight: bold;">${inc.type}</span>
              <span>‚è±Ô∏è ${timeStr}</span>
            </div>
            <div class="queue-title">${inc.priority === 1 ? 'üö® NOODOPROEP' : inc.title}</div>
            <div class="queue-location">üìç ${inc.location}</div>
            <div style="font-size: 10px; margin-top: 4px;">Lijn ${inc.lijn} ‚Ä¢ ${inc.caller}</div>
            <button class="queue-btn" onclick="acceptIncident('${inc.id}')">OPPAKKEN</button>
          </div>
        `;
      }).join('');
    }

    function showWaiting() {
      document.getElementById('centerContent').innerHTML = `
        <div class="start-screen">
          <div style="font-size: 48px; margin-bottom: 20px;">üìû</div>
          <h2>Selecteer een oproep uit de wachtrij</h2>
          <p style="margin-top: 15px; color: #666;">
            ${incidentQueue.filter(i => i.priority === 1).length > 0 ? 
              '<span style="color: #c00; font-weight: bold;">‚ö†Ô∏è NOODOPROEP WACHT!</span>' : 
              incidentQueue.length + ' incidenten in wachtrij'}
          </p>
        </div>
      `;
    }

    function acceptIncident(id) {
      currentIncident = incidentQueue.find(i => i.id === id);
      incidentQueue = incidentQueue.filter(i => i.id !== id);
      currentQuestionIndex = 0;
      updateCallList();
      updateQueue();
      displayConversation();
      startCallTimer();
    }

    function startCallTimer() {
      const start = Date.now();
      if (callTimer) clearInterval(callTimer);
      callTimer = setInterval(() => {
        const el = document.querySelector('.call-duration');
        if (!el) return;
        const elapsed = Math.floor((Date.now() - start) / 1000);
        const min = Math.floor(elapsed / 60);
        const sec = elapsed % 60;
        el.textContent = String(min).padStart(2, '0') + ':' + String(sec).padStart(2, '0');
      }, 1000);
    }

    function displayConversation() {
      const inc = currentIncident;
      const content = document.getElementById('centerContent');
      
      content.innerHTML = `
        <div class="conversation-area">
          <div class="conversation-header">
            <div class="caller-name">${inc.priority === 1 ? 'üö® NOODOPROEP - ' : ''}${inc.caller} (Lijn ${inc.lijn})</div>
            <div class="call-duration">00:00</div>
          </div>
          
          <div class="trip-card">
            <div class="trip-row">
              <div class="trip-field">
                <div class="trip-label">Lijn</div>
                <div class="trip-value">${inc.lijn}</div>
              </div>
              <div class="trip-field">
                <div class="trip-label">Rit</div>
                <div class="trip-value">${inc.rit}</div>
              </div>
              <div class="trip-field">
                <div class="trip-label">Omloop</div>
                <div class="trip-value">${inc.omloop}</div>
              </div>
              <div class="trip-field">
                <div class="trip-label">Dienst</div>
                <div class="trip-value">${inc.dienst}</div>
              </div>
            </div>
            <div class="trip-route">üìç ${inc.location} ‚Ä¢ ${inc.vestiging}</div>
          </div>
          
          <div class="conversation-messages" id="messages"></div>
          <div class="response-options" id="responseArea"></div>
        </div>
      `;

      showNextQuestion();
    }

    function showNextQuestion() {
      const msgs = document.getElementById('messages');
      const respArea = document.getElementById('responseArea');
      const inc = currentIncident;
      
      if (!msgs || !respArea || !inc) {
        console.error('Missende elementen:', { msgs, respArea, inc });
        return;
      }
      
      // Toon alle vorige berichten
      msgs.innerHTML = inc.conversation.map(m => {
        if (m.type === 'system') {
          return `<div class="message system"><div class="message-content">${m.text}</div></div>`;
        }
        const isChauffeur = m.sender && m.sender.includes('Chauffeur');
        return `
          <div class="message ${isChauffeur ? 'from-chauffeur' : 'from-rov'}">
            <div class="message-header">
              <span>${m.sender}</span>
              <span>${m.time || ''}</span>
            </div>
            <div class="message-content">${m.text}</div>
          </div>
        `;
      }).join('');

      if (currentQuestionIndex < inc.questions.length) {
        const q = inc.questions[currentQuestionIndex];
        
        if (!q || !q.rovOptions) {
          console.error('Vraag of opties ontbreken:', q);
          respArea.innerHTML = '<div style="color: #E30613; padding: 20px;">FOUT: Vraag niet gevonden. Klik op "Volgende"</div><button class="start-btn" onclick="nextIncident()">Volgende</button>';
          return;
        }
        
        respArea.innerHTML = `
          <div style="background: rgba(72,187,120,.15); padding: 12px; border-radius: 4px; margin-bottom: 12px; border-left: 3px solid #48bb78;">
            <div style="color: #48bb78; font-weight: bold; margin-bottom: 8px; font-size: 12px;">üìã SITUATIE:</div>
            <div style="color: #e0e0e0; margin-bottom: 12px; font-size: 12px;">${q.situation}</div>
            <div style="color: #f6ad55; font-weight: bold; margin-bottom: 8px; font-size: 12px;">üí¨ Kies de juiste vraag/actie als ROV:</div>
          </div>
          ${q.rovOptions.map((opt, idx) => `
            <button class="response-btn" onclick="selectROVQuestion(${idx})">
              ${opt.question}
            </button>
          `).join('')}
        `;
      } else {
        showFinalQuestion();
      }

      msgs.scrollTop = msgs.scrollHeight;
    }

    function selectROVQuestion(idx) {
      const q = currentIncident.questions[currentQuestionIndex];
      const opt = q.rovOptions[idx];
      
      // Toon feedback op knoppen
      const btns = document.querySelectorAll('.response-btn');
      btns.forEach((b, i) => {
        b.disabled = true;
        if (q.rovOptions[i].correct) {
          b.classList.add('correct');
        } else if (i === idx && !opt.correct) {
          b.classList.add('incorrect');
        }
      });

      // Voeg ROV vraag toe aan gesprek
      currentIncident.conversation.push({
        sender: 'ROV (jij)',
        text: opt.question,
        time: getCallTime()
      });
      
      // Voeg chauffeur antwoord toe
      currentIncident.conversation.push({
        sender: currentIncident.caller,
        text: opt.chauffeurResponse,
        time: getCallTime()
      });

      // Toon korte feedback
      const respArea = document.getElementById('responseArea');
      respArea.innerHTML += `
        <div class="feedback ${opt.correct ? '' : 'negative'}" style="margin-top: 10px;">
          <strong>${opt.correct ? '‚úì GOEDE VRAAG!' : '‚úó VERKEERDE VRAAG!'}</strong><br>
          ${opt.feedback}
        </div>
      `;
      
      setTimeout(() => {
        currentQuestionIndex++;
        showNextQuestion();
      }, 2000);
    }

    function showFinalQuestion() {
      const respArea = document.getElementById('responseArea');
      const fq = currentIncident.finalQuestion;
      
      respArea.innerHTML = `
        <div style="background: #fff3cd; padding: 12px; border-radius: 4px; margin-bottom: 10px; border: 2px solid #ff9800;">
          <strong>üìã ${fq.question}</strong>
        </div>
        ${fq.options.map((opt, idx) => `
          <button class="response-btn" onclick="selectFinalAnswer(${idx})">
            ${opt.text}
          </button>
        `).join('')}
      `;
    }

    function selectFinalAnswer(idx) {
      const opt = currentIncident.finalQuestion.options[idx];
      score += opt.points;
      document.getElementById('scoreDisplay').textContent = score;
      
      const btns = document.querySelectorAll('.response-btn');
      btns.forEach((b, i) => {
        b.disabled = true;
        if (currentIncident.finalQuestion.options[i].correct) {
          b.classList.add('correct');
        } else if (i === idx && !opt.correct) {
          b.classList.add('incorrect');
        }
      });

      const respArea = document.getElementById('responseArea');
      respArea.innerHTML += `
        <div class="feedback ${opt.correct ? '' : 'negative'}">
          <strong>${opt.correct ? '‚úì CORRECT!' : '‚úó INCORRECT!'}</strong><br>
          ${opt.feedback}<br><br>
          <strong>Punten: ${opt.points > 0 ? '+' : ''}${opt.points}</strong>
        </div>
        <button class="start-btn" style="margin-top: 10px; width: 100%;" onclick="nextIncident()">
          Volgende (${incidentQueue.length} wachtend)
        </button>
      `;
    }

    function nextIncident() {
      if (callTimer) clearInterval(callTimer);
      currentIncident = null;
      currentQuestionIndex = 0;
      
      if (incidentQueue.length > 0) {
        showWaiting();
      } else {
        endShift();
      }
    }

    function endShift() {
      document.getElementById('centerContent').innerHTML = `
        <div class="start-screen">
          <div class="start-title">Training Afgerond</div>
          <div style="font-size: 48px; color: #4caf50; margin: 20px 0;">${score} punten</div>
          <div class="start-desc">
            Goed werk! Je hebt alle incidenten afgehandeld.<br>
            Eindscore: <strong>${score}</strong> punten
          </div>
          <button class="start-btn" onclick="location.reload()">Nieuwe Shift</button>
        </div>
      `;
    }

    function getCallTime() {
      const el = document.querySelector('.call-duration');
      return el ? el.textContent : '00:00';
    }

    // Start
    showStart();
  </script>
</body>
</html>
